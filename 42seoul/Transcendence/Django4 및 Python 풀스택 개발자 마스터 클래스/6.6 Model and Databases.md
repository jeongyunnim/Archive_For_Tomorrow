---
날짜: '"2024-01-03"'
넘버: 
태그: 프로그래밍
출처: Django 4 및 Python 풀스택 개발자 마스터 클래스
저자: Jose Portilla
aliases:
---
### 날짜  2024-01-03 21:30

### 태그: #프로그래밍 

>[!메모]
> SQL 기반 데이터베이스에서 데이터를 저장, 검색, 업데이트 및 삭제하는 방법.
> 프로젝트가 커지면 결국 앱을 만들고, 그 앱과 연결된 모델을 만들게 될 것이다.
### Overview
- 데이터베이스의 일반적인 개요
- 모델과 데이터베이스
- 모델과 필드 생성
- 마이그레이션
- 데이터 상호작용-[[CRUD]]
- 데이터베이스와 템플릿의 상호작용
### 원문
---
# Model
- 데이터베이스와 직접적인 상호작용을 수행하는 MTV의 핵심부분.
## Database
### SQL database
- 스프레드시트(Excel) 형식으로 저장되는 테이블 포맷.
- SQL type의 데이터베이스 예시
	- MySQL
	- SQLite
	- PostgereSQL
	- MS SQL

| **id** | **name** | **color** |
| ---- | ---- | ---- |
| 0 | John | blue |
| 1 | Mary | red |
### NoSQL
- MongoDB 또는 NoSQL 데이터베이스
- Python 딕셔너리와 유사하게 키-값 pair로 저장한다.
```NoSQL
{"id":0, "name":"John", "color":"blue"}
{"id":1, "name":"Mary", "color":"red"}
```
- 두 방식에는 더 나은지의 차이가 없다.
### Django
- 테이블 포맷의 SQL 기반 포맷과 잘 작동되도록 설계된 프레임워크
- 만약 NoSQL로 작업을 해야한다면 먼저 SQL로 작업하는 것을 추천한다.
- 다른 SQL 엔진을 사용하게 되었다면, Django 코드를 변경하는 것이 아니라 그저 settings.py에 database엔진 설정 부분을 변경해주기만 하면 된다.
- SQLite로 시작하는 것이 좋다.
	- 파이썬에 이미 설치가 되어있음.
	- sqlite.org/whentouse.html
	- 하루에 100,000 이상 클릭되지 않는 사이트는 SQLite로도 충분히 처리할 수 있다.
- Django의 모델을 사용하는 작업들과, Python 코드는 SQL 항목들과 1대1 연결이 되는 경우가 많다.
## Model and Databases
- Django 모델은 app 내에서 정의되거나 프로젝트 레벨의 model.py에서 정의된다.
### Django 모델의 핵심 개념
- builtin 모델 클래스를 상속받는다.
- 필드를 사용하여 type과 data constraints 를 모두 정의 한다.
	- 필수적으로 요구하는 데이터가 있는 경우 `NOT NULL` 해당 테이블에 제약조건을 적용할 수 있음.
	- Unique 해야 하는 계정 정보들은 `UNIQUE` 제약 조건을 적용할 수 있다.
```python
from djnago.db import models

class Person(models.Model):
	first_name = models.CharField(max_length=30)
	last_name = models.CharField(max_length=30)
```
- field에 관한 공식문서
	- https://docs.djangoproject.com/en/5.0/ref/models/fields/
- Feature 섹션에서 템플릿을 클래스 기반 뷰 모델에 연결하면 자동으로 템플릿을 생성해준다.
## Model And Fields
```python
# settings.py
DATABASES = {
	'default': {
		'ENGINE': 'django.db.backends.sqlite3',
		'NAME': BASE_DIR / 'db.sqlite3',
	}
}
```
- 프로젝트를 실행했을 때, default로 지정되는 값.
	- Python을 설치했을 때, sqlite3이 함께 설치된다는 사실을 알고 있다.
- database 공식문서
	- https://docs.djangoproject.com/en/5.0/ref/settings/#databases
![[Pasted image 20240104173448.png]]
- 각 백엔드에 대한 설정에 대한 안내가 자세히 나와있다. 변경을 해야하는 경우 공식페이지를 참고할 것
### 예제 준비
```bash
$> django-admin startproject my_site
$> cd my_site
$> python manage.py startapp office
$> python manage.py migrate
(...outputs...)
```
- 모델은 class로 선언하여 데이터베이스와 연결한다.
	- 각 속성은 database의 column이 된다.
	- 필드가 가질 수 속성의 목록은 공식문서를 참고하라.
		- https://docs.djangoproject.com/en/5.0/ref/models/fields
	- CharField
	- DateField
	- IntegerField
- Django에서 제공하는 Validators 라는 유효성 검사기가 있다.
	- 사용자 입력이 올바른지 검사한다.
- app 레벨의 model.py에 클래스를 선언한다.
```python
# models.py
from django.db import models

class Patient(models.Model):
	first_name = models.CharField(max_length=30)
	last_name = models.CharField(max_length=30)
	age = models.IntegerField()
```
## Migration
- Django 애플리케이션의 변경 사항을 백엔드 데이터베이스에 연결하는 작업.
	- 모델 추가
	- app 추가
	- 모델의 속성 업데이트
- Python 코드에서 백엔드 SQL 데이터베이스로 마이그레이션 되어야 한다.
- **핵심 명령어**
	- makemigrations
	- migrate
	- sqlmigrate
### makemigrations
- `python manage.py makemigrations app`
	- 데이터베이스에 변경 사항을 적용할 명령 집합을 생성한다.
	- python 파일이 생성되고 데이터베이스를 변경하기 위해 실행할 준비가 된다.
	- 실행하지는 않기 때문에 데이터베이스에 대한 변경을 수행하지 않는다.
	- 관리자 또는 인증 같은 기본 애플리케이션은 SQL makemigrateions 코드가 이미 존재하지만,  migration이 되어있는 상태는 아니다.
	- `app/migrations/0001_initial.py`파일이 생성되었을 것이다.
		- 실제 migration 하기 전 python 코드를 탐색하고 편집할 수 있다.
### migrate
- 기존 migrations를 실행한다.
	- migrations 폴더를 찾아 해당 python 파일을 실행한다.
### sqlmigrate
- `python manage.py sqlmigrate app 0001`
- 사용하기가 더 복잡하고, 자주 사용하지 않을 것이다.
	- 애플리케이션 이름과 특정 마이그레이션 Python 파일과 연결된 번호를 실행하면 실제로 SQL 코드를 만들어준다.
	- 데이터베이스에서 실행되고 있는 SQL 코드를 확인하려는 경우 유용
- 디버깅 용
### Steps for migrations
```
1. 프로젝트를 migrate 한다.
2. app과 model을 생성한다.
3. settings.py에 추가할 app을 INSTALLED_APPS에 추가한다.
4. makemigrations를 실행한다.
5. migrate를 실행한다.
```
### 프로젝트에서 앱을 분리하는 법
```
1. 앱을 만들고 앱을 등록한다.
2. 새 앱에 대한 makemigrations를 실행한다.
3. migration을 실행한다.
```

```sh
$> python manage.py makemigrations office
Migrations for 'office':
  office/migrations/0001_initial.py
    - Create model Patient

$> python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, office, sessions
Running migrations:
  Applying office.0001_initial... OK
```
- `office.0001_initial`파일은 데이터베이스와 상호작용하기 위해 실제 SQL 코드를 생성한다.
- SQL문으로 변환된 것을 확인하고 싶다면,
```sh
$> python manage.py sqlmigrate office 0001
BEGIN;
--
-- Create model Patient
--
CREATE TABLE "office_patient" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "first_name" varchar(30) NOT NULL, "last_name" varchar(30) NOT NULL, "age" integer NOT NULL);
COMMIT;
```
## Data Interaction: Creation and Insertion
- Django 모델을 이용하여 SQL 테이블에 데이터를 삽입하는 것이 굉장히 쉽다.
- 
---
### 생각(파생된 질문/생각)

### 출처

### 연결 문서 (연결 이유)
