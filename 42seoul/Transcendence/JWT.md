---
날짜: 2024-02-19
넘버: 
태그: 프로그래밍/보안
출처: https://datatracker.ietf.org/doc/html/rfc7519
aliases:
---
### 날짜  2024-02-19 17:12

### 태그:

>[!메모]
>

### 원문
---
# JWT
[RFC 7519](https://datatracker.ietf.org/doc/html/rfc7519)
https://jwt.io/introduction
## 개요
- JWT(JSON Web Token)는 compact 하고 URL-safe 하다.
	- 두 당사자의 claim 교환을 나타내는 방법이다.
	- **claim**
		- subject에 대해 주장되는 정보, 클레임 이름과 클레임 값으로 구성된 키/값 쌍으로 저장된다.
- 요청은 JSON 객체로 인코딩 되어있다.
## What is JSON Web Token?
- JSON 객체로 정보를 안전하게 전달하기 위한 표준
	- 디지털로 서명되어있다.
	- 비밀키(HMAC)로 서명하거나 공개/비공개 키(RSA, ECDSA) 쌍으로 서명할 수 있다.
- 서명된 토큰
	- 그 안에 포함된 클레임의 무결정을 확인한다.
	- 토큰 내의 데이터가 전송 중에 조작되지 않았음을 보장한다.
	- 암호화된 토큰은 의도된 수신자 외의 다른 사용자로부터 클레임을 숨긴다.
- 공개/비공개 키를 사용한 서명
	- 토큰의 무결성 확인
	- 토큰이 서명된 개인 키를 소유한 당사자로부터 생성되었음을 인증
		- 개인 키를 소유한 엔티티만이 토큰일 생성할 수 있다는 것을 추가적으로 보장한다.
## When should you use JSON Web Tokens?
- Authorization
	- 유저가 로그인 한 후, 각 후속 요청에 JWT가 포함되어있어 해당 토큰으로 허용된 경로, 서비스, 리소스에 접근할 수 있다.
	- 최근에는 Single Sign On이라는 기능이 널리 사용되고 있다.
		- JWT의 작은 오버헤드와 여러 도메인 간 쉽게 사용할 수 있다.
- Information Exchange
	- JWT는 서명을 할 수 있기 때문에 보낸 사람이 자신이 claim하는 주체라는 것을 보증할 수 있다.
	- 서명은 헤더와 페이로드를 사용하여 계산한다.
## What is the JSON Web Token structure?
- 세 개의 부분으로 구성된다.
	- 헤더
		- 토큰의 유형, 사용된 서명 알고리즘
	- 페이로드
		- claim, 일반적 엔티티(사용자 등)에 대한 선언적인 명세, 추가 데이터
	- 서명
		- JWT의 발송지가 자신의 claim대로 신원을 확인하고 메시지가 전송 중 변경되지 않았음을 보장
- JWT의 형식
```JWT
xxxxx.yyyyy.zzzzz
```
### Header
- 헤더는 일반적으로 두 부분으로 나뉜다.
	- 토큰의 종류, 서명 알고리즘
```json
{
	"alg": "HS256",
	"typ": "JWT"
}
```
- 이 헤더는 Base64Url로 인코딩되어 JWT의 첫 번째 부분을 형성한다.
### Payload
- 세 가지 유형의 클레임이 있다.
	- 등록된 클레임
	- 공개 클레임
	- 비공개 클레임
#### 등록된 클레임
- 사전 정의된 클레임의 집합
- 클레임 이름은 JWT의 간결성을 위해 3글자로만 구성된다.
	- iss: 발급자
	- exp: 만료 시간
	- sub: 주체
	- aud: 대상 청중
#### 공개 클레임
- JWT를 사용하는 사람들이 자유롭게 정의할 수 있는 클레임
- IANA JSON Web Token 레지스트리에 정의되거나 충돌이어 없어야 한다.
#### 비공개 클레임
- 사용하는 당사자 간에 정보를 공유하기 위한 사용자 정의 클레임
```json
{ 
	"sub": "1234567890", 
	"name": "John Doe", 
	"admin": true 
}
```
- 이 헤더는 Base64Url로 인코딩되어 JWT의 두 번째 부분을 형성한다.
- 서명된 토큰의 경우 이 정보는 변조를 방지하도록 보호되어 있지만 누구나 읽을 수 있다.
	- 중요한 정보는 JWT의 페이로드나 헤더에 넣으면 안 된다.
### Signature
- 서명하기 위한 준비물
	- 인코딩된 헤더
	- 인코딩된 페이로드
	- 비밀키
	- 헤더에서 지정된 알고리즘
- 서명은 메시지가 전송 중 변경되지 않았음을 확인하는 데 사용된다.
```json
HMACSHA256( 
	base64UrlEncode(header) + "." + 
	base64UrlEncode(payload), 
	secret)
```
### 완성된 JWT
- 세 개의 Base64-URL 문자열이 점으로 구분되어 HTML및 HTTP 환경에서 쉽게 전달될 수 있다.
- [JSON.io](https://chat.openai.com/c/4f666372-12a6-4a38-905f-ee0f566d8a5b)에서 디버깅 할 수 있다.
![[Pasted image 20240220165256.png]]
## How do JSON Web Token work?
- 유저가 로그인을 하면 JWT가 반환된다.
	- 인증에서 사용자가 자격 증명을 사용하여 성공적으로 로그인을 한 경우
- 토큰은 자격 증명이기 때문에 보안 문제를 방지하기 위해 주의를 기울여야 한다.
	- 토큰의 만료기간이 너무 길어서는 안 된다.
- 브라우저 스토리지에 **세션 데이터를 저장**하면 안된다.
- 사용자가 리소스에 접근하려고할 때 사용자 에이전트가 JWT를 사용해서 인증 헤더에 전송해야 한다.
- 인증헤더 형식은 [[Bearer]]를 사용한다.
```
Authorization: Bearer <token>
```
- 특정 경우, 상태를 유지하지 않는 인가 메커니즘이 될 수 있다.
- 서버는 인증 헤더에서 JWT를 확인하고 해당 토큰이 있는 경우 리소스에 접근을 허용해준다.
- JWT에 필요한 데이터가 포함되어있다면 특정 작업을 위한 DB 쿼리가 줄어들 수 있다.
- HTTP 헤더를 통해 전송하는 경우, 토큰의 크기가 너무 커지지 않도록 해야 한다.
	- 너무 많은 정보를 담으려고 하는 경우 제한할 수 있다.
- 토큰이 Authorization 헤더를 통해 전송된다면 CORS(Cross-Origin Resource Sharing) 문제가 발생하지 않을 것이다.
	- 토큰이 쿠키를 사용하지 않기 때문이다.
```
1. 애플리케이션 또는 클라이언트의 권한 요청
	- 권한 부여 서버에 대한 권한을 요청한다.
		- 권한 부여 플로우 중 하나를 사용한다.
2. 권한 부여 허가
3. 애플리케이션에서 보호된 리소스 접근
```
- 서명된 토큰을 사용하면 포함된 정보의 무결성을 보장하여 변조를 감지한다.
	- 모든 정보가 토큰 내에서 공개되기 때문에 사용자나 토큰에 액세스할 수 있는 다른 당사자에게 노출된다.
	- 민감한 정보, 비밀 정보는 토큰 페이로드에 포함해서는 안 된다.
![[Pasted image 20240220184858.png]]
---
### 생각(파생된 질문/생각)

### 출처

### 연결 문서 (연결 이유)
