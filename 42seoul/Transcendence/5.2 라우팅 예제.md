---
날짜: 2024-02-27
넘버: 
태그: 
출처: 
aliases:
---
### 날짜  2024-02-27 17:07

### 태그:

>[!메모]
>

### 원문
---
# 라우팅 예제
- 3가지의 방법으로 작성한다.
	- 프래그먼트 식별자
		- 경로  매개변수
	- 히스토리 API
### 프래그먼트  식별자 '`#`'
- 프래그먼트의 목적
	- 웹 페이지의 특정 섹션을 식별하는 것.
	- 프래그먼트 식별자가 포함된 URL을 탐색할 때 브라우저는 프래그먼트로 식별된 요소가 viewport의 맨 위에 오도록 페이지를 스크롤 한다.
## 간단한 SPA의 예제
```html
<body>
	<header>
		<a href="#/">Go To Index</a>
		<a href="#/list">Go To List</a>
		<a href="#/dummy">Dummy Page</a>
	</header>
	<main></main>
</body>
```
- `<a href="#/">Go To Index</a>`
	- localhost:8000#/
- `<a href="#/list">Go To List</a>`
	- localhost#/list
- URL이 변경되면 메인 컨테이너 내부에 현재의 구성 요소를 넣는다.	
### 기본 SPA의 구성요소
```js
export default container => {
	const home = () => {
		container
			.textContent = 'This is Home page'
	}
	const list = () => {
		container
			.textContent = 'This is List page'
	}
	return {
		home,
		list,
	}
}
```
### 잘못된 경로 처리
- Not Found Component 
```js
const notFound = () => {
	container.textContent = "Page Not Found!"
}
```
### 기본 라우터 구성
- 라우터가 동작하게 하기 위해 라우터를 구성하고 컴포넌트를 올바른 프래그먼트에 연결해야 한다.
```js
import createRouter from './router.js'
import createPages from './pages.js'

const container = document.querySelector('main')

const pages = createPages(container)

const router = createRouter()

router
	.addRoute('#/', pages.home)
	.addRoute('#/list', pages.list)
	.setNotFound(pages.notFount)
	.start()
```
- router
	- 3가지의 공개 메서드를 가진다. 
- addRoute()
	- 라우터와 프래그먼트로 구성된 구성 객체, 컴포넌트를 정의한다.
- setNotFound()
	- 레지스트리에 없는 모든 프래그먼트에 대한 generic 컴포넌트
- start()
	라우터를 초기화하고 URL 변경을 listen한다.
### 기본 라우터 구현
```js
export default () => {
	const routes = [];
	let notFound = () => {};

	const router = {};
	
	const checkRoutes = () => {
		const currentRoute = routes.find((route) => {
			return route.fragment === window.location.hash;
		});

		if (!currentRoute) {
			notFOund();
			return ;
		}

		currentRoute.component();
	};

	router.setNotFound = (cb) => {
		notFound = cb;
		return router;
	}

	router.start = () => {
		window.addEventListner("hashchange", checkRoutes);

		if (!window.location.hash) {
			window.location.hash = "#/";
		}

		checkRoutes();
	}
	return router;
}
```
- checkRoute()
	- 현제 프래그먼트와 일치하는 경로를 찾는다.
	- 경로가 발견되면 해당 구성 요소 함수가 메인 컨테이너에 있는 콘텐츠를 대체한다.
	- 발견되지 않을 경우 notFound() 메서드가 호출된다.
	- hashchange 이벤트가 발생할 때마다 호출된다.
![[Excalidraw/JavaScript.excalidraw.md#^group=Xk9xw-W-8GoxrvfkSp975]]
## 프로그래밍 방식으로 탐색
- 위의 예제에서 앵커를 클릭하는 방식으로 탐색이 활성화되는 것을 보았다.
	- 때로는 프로그래밍 방식으로 뷰의 변경이 필요한 경우도 있다.
		- 로그인에 성공한 사용자를 개인 페이지로 리디렉션 하기 등
```html
<body>
	<header>
		<button data-navigate="/">
			Go to index
		</button>
		<button data-navigate="/list">
			Go to list
		</button>
		<button data-navigate="/dummy">
			Dummy page
		</button>
	</header>
	<main>
	</main>
</body>
```
### 버튼에 탐색 추가
```js
const NAV_BTN_SELECTOR = 'button[data-navigate]';

document
	.body
	.addEventistener('click', e => {
		const { target } = e
		if (target.matches(NAV_BTN_SELECTOR)) {
			const { navigate } = target.dataset;
			router.navigate(navigate);
		}
	})
```
- 다른 뷰로 연결하는 프로그래밍적 방식
	- 새로운 프로개르먼트를 가져와서 location 객체에서 대체한다.
```js
router.navigate = fragment => {
	window.location.hash = fragment
}
```
- 라우터의 내부를 변경해줄 때는 함수에서 이 라인을 래핑해야 한다.
### 경로 매개변수
- 라우터에 매개변수 읽기 기능을 추가한다.
	- 도메인 변수와 관련된 URL의 일부이다.
	- `http://localhost:8000#/order/1`
		- order: 도메인 모델의 ID
		- 1: id라는 경로 매개변수
- 매개변수가 있는 컴포넌트
```js
const detail - (params) => {
	const { id } = params;
	container
		.textContent = `
			This is Detail Page with ID ${id}
		`;
}

const anotherDetail = (params) => {  
	const { id, anotherId } = params;  
	container.textContent = `
		This is Detail Page with Id ${id} and AnotherId ${anotherId}
		`;  
};
```
### 매개변수 경로 정의
- 위의 두 가지 컴포넌트를 URL과 바인딩
```js
router  
	.addRoute("#/", pages.home)  
	.addRoute("#/list", pages.list)  
	.addRoute("#/list/:id", pages.detail)  
	.addRoute("#/list/:id/:anotherId", pages.anotherDetail)  
	.setNotFound(pages.notFound)  
	.start();
```
### 프래그먼트에서 매개변수 이름 추출
- 경로 매개변수 관리를 위해서 라우터 구현을 수정해야 한다.
	- 해당 구현은 정규 표현식을 기반으로 한다.
		- [Regex101](https://regex101.com/)에서 배워보는 것도 추천
	- `#/list/:id/:anotherId`에서 id와 anotherId를 가진 배열을 추출해야 한다.
```js
const ROUTE_PARAMETER_REGEXP = /:(\w+)/g;  
const URL_FRAGMENT_REGEXP = "C[^\\/]+)";  
  
router.addRoute = (fragment, component) => {  
	const params = [];  
  
	const parsedFragment = fragment  
		.replace(ROUTE_PARAMETER_REGEXP, (match, paramName) => {  
			params.push(paramName);  
			return URL_FRAGMENT_REGEXP;  
		})  
	.replace(/\//g, "\\/");  
  
	routes.push({  
		testRegExp: new RegExp(`^${parsedFragment}$`),  
		component,  
		params,  
	});  
  
	return router;  
};
```
- 프래그먼트에서 매개변수 이름을 추출하려면 정규식을 사용한다.
	- `/:(\w+)/g`
	- 이 정규식은 `:id`와 `:anotherId`에 매칭된다.
- `:(\w+)`
	- `:`는 정확하게 한 문자와 매칭한다.
	- `()`는 캡처 그룹의 시작을 나타낸다.
	- `\w`는 `[a-zA-Z0-9_]`의 단축어로 모든 표준문자와 매칭된다.
	- `+`는 하나 이상의 표준 문자 허용을 나타낸다.
- 이 정규식은 String 객체의 replace 함수와 함께 사용한다.
	- 콜백은 정규식이 대상 String과 매칭될 때마다 호출된다.
	- 콜백의 두 번째 인수
		- params 배열에 추가하는 매개변수의 이름
	- 그런 다음 다른 정규식으로 매칭이 바뀐다.
---
### 생각(파생된 질문/생각)

### 출처

### 연결 문서 (연결 이유)
