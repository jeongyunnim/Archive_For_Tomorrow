---
날짜: 2024-07-30
넘버: 
태그: 프로그래밍
저자: Eazy Bytes
출처: https://www.udemy.com/course/master-microservices-with-springboot-docker-kubernetes-korean/
aliases:
---
 ### 날짜:  2024-07-30 21:38

### 태그: #프로그래밍 #자바 #스프링

>[!메모]
>

### 원문
---
# 서킷 브레이커 패턴
- 모종의 오류로 인해 오류가 생겼을 때 해당 인스턴스에 대한 접근을 막고, 
- 일시적인 결함이나 네트워크 속도 저하, 시간 초과, 리소스 초과 할당, 일시적 사용 불가 등 여러 가지 이유로 인해 호출이 실패할 수 있다.

- 주로 발생하는 문제는 **응답 지연**이다.
	- 영구히 지속되는 문제가 아니며, 어느 정도 시간이 지나면 복구될 것이다.
	- 이와 비슷한 일시적 지연은 어떻게 대처해야 하는지가 중요하다.

- 모든 호출을 모니터링하고 있기 때문에 응답이 느리거나 네트워크 문제로 인해 대부분의 호출이 실패하는 경우 회로 차단기 구현이 팝업된다.
	- 복구되기 전까지 해당 마이크로서비스로 향하는 모든 요청을 차단한다.
	- 즉시 실패 응답을 전송한다.

- 빠르게 장애를 처리하기 때문에 에러 전파를 방지할 수 있다.

- 서킷 브레이커는 마이크로서비스로 partial traffic을 보내어 복구 여부를 확인한다.
	- 복구가 안 되었다면 몇 초/분 간 접속을 차단한다.

## 서킷 브레이커의 3가지 상태
- 기본적으로 서킷 브레이커는 모든 마이크로서비스를 모니터링하지 않는다.
	- 필요한 서비스에 서킷 브레이커 패턴을 등록시켜줘야 한다.
![[Pasted image 20240731122446.png]]
### CLOSED 상태
- 애플리케이션이 시작되었을 때 가지는 상태
- 모든 요청을 수락한다.
- 마이크로서비스로 들어오는 모든 요청을 모니터링한다. 
	- 마이크로서비스가 제대로 응답하고 있는가 
	- 네트워크 문제가 있는가
	- 마이크로서비스의 응답이 느린가
### OPEN 상태
- 애플리케이션으로 들어오는 요청이 대부분 실패한다는 것을 감지하면 열린 상태로 전환된다.
- 언제 열린 상태로 전환되는지 설정할 수 있다.
	- 50%, 80% 등
- 언제까지 OPEN 상태를 유지할지 설정할 수 있다.
	- 30s, 60s 등
- 실제 마이크로서비스에 요청을 보내지 않는다.
- 즉시 실패하고 클라이언트 애플리케이션에 오류 응답을 보낸다.
### HALF_OPEN 상태
- 사용자가 설정한 OPEN 상태 유지시간이 지난 후 HALF_OPEN 상태로 전환된다.
- 이 상태에서는 설정에 따라 몇 개의 요청만 허용한다.
	- 10개, 20개 등
- 요청이 설정 비율(50%) 이상 실패하면 다시 OPEN 상태로 돌아간다.
	- CLOSED - OPEN - HALF_OPEN - OPEN - HALF_OPEN - CLOSED
- 요청이 설정 비율 이상 성공하면 다시 CLOSED 상태로 전환된다.


---
### 생각(파생된 질문/생각)

### 출처
- [유데미 - Java, Spring Boot, Spring Cloud, Docker, Kubernetes, Helm, 마이크로서비스 보안](https://www.udemy.com/course/master-microservices-with-springboot-docker-kubernetes-korean/)

### 연결 문서 (연결 이유)
