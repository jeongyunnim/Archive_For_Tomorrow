---
날짜: 2024-08-13
넘버: 
태그: 프로그래밍
저자: Eazy Bytes
출처: https://www.udemy.com/course/master-microservices-with-springboot-docker-kubernetes-korean/
aliases:
---
### 날짜:  2024-08-13 00:29

### 태그: #프로그래밍 #자바 #스프링

>[!메모]
> 로깅과 메트릭은 애플리케이션의 내부 상태 또는 전반적 상태를 도출한다.
> 모니터링과 Observability 를 위한 3 번째 축 **분산 추적**을 알아보자.

### 원문
---
# 마이크로서비스의 분산 추적

## 분산 추적
- 이벤트 로그, healthy probe, 메트릭 등은 분산 환경에서 문제를 디버깅하는 데 큰 도움이 되지 못한다.
- 사용자의 특정 요청이 여러 서비스를 거쳐갈 수 있다.
	- 특정 흐름에서 **어떤 서비스**에서 **어떤 문제**가 발생했는지 추적할 수 있어야 한다.
		- 어떤 서비스까지 요청이 이동했는지
		- 해당 서비스에서 소요되는 시간
### 목적
- 분산된 환경 내부의 구성요소에 전파되는 요청의 흐름을 분석하는 데 사용된다.
- 복잡한 시스템 내부의 문제를 진단할 수 있다.
### 분산추적을 구현하는 방법 - correlation ID
- **correlation ID**(고유 식별자)를 마이크로서비스의 진입점에서 각 요청마다 생성한다.
- 하지만 모든 로그에 대해 correlation ID를 생성하는 것은 개발자가 하는 일이어서는 안 된다.
## 분산 추적 구현의 3가지 기준
### 1. 태그
- 세부 정보를 제공하는 메타 데이터를 build 한다.
	- 인증된 사용자의 이름, 마이크로 식별자 등
- 메타 데이터를 로그에 첨부한다.
	- 특정 로그가 어떤 서비스에 속하는 정보인지 쉽게 알 수 있다.
### 2. Trace ID
- 요청이 시작될 때 생성되어야 한다.
	- gateway에서 마이크로서비스 네트워크로 진입하려고 할 때
- 이동하는 서비스에 상관 없이 한 요청에 해당하는 Trace ID를 함께 출력해야 한다.
### 3. Span ID
- 요청 처리의 각 개별 단계를 나타낸다.
	- 서비스 안에서 여러 메서드를 호출할 수 있다.
- 각 마이크로서비스에 고유한 ID 값을 할당해야 한다.
### 예시
- 사용자가 엣지 서버로 요청을 전송하여 Accounts 서비스 내의 customerDetail API를 호출하는 시나리오
![[Pasted image 20240813011824.png]]
- `[tag, traceId, spanId]`
	- tag는 각 로그가 어떤 서비스에 속하는지 쉽게 알 수 있다.
	- traceId는 동일한 요청에 대하여 동일한 ID 값을 가지고 있다.
	- spanId는 특정 마이크로서비스의 로그에 대해 동일한 ID 값을 가지고 있다.
- tag를 application 이름 대신 사용자의 이름으로 설정하면 특정 사용자의 요청의 작업 로그를 쉽게 추적할 수 있다.
- 애플리케이션마다 고유한 Span ID가 있어 요청이 어디까지 처리되었는지 쉽게 추적할 수 있다.

---
### 생각(파생된 질문/생각)

### 출처
- [유데미 - Java, Spring Boot, Spring Cloud, Docker, Kubernetes, Helm, 마이크로서비스 보안](https://www.udemy.com/course/master-microservices-with-springboot-docker-kubernetes-korean/)

### 연결 문서 (연결 이유)
