---
날짜: 2024-07-24
넘버: 
태그: 프로그래밍
저자: Eazy Bytes
출처: https://www.udemy.com/course/master-microservices-with-springboot-docker-kubernetes-korean/
aliases:
---
### 날짜:  2024-07-24 19:41

### 태그: #프로그래밍 #자바 #스프링

>[!메모]
>

### 원문
---
# 서비스 검색 및 등록 - 서비스 디스커버리 패턴
### 서비스 디스커버리
- 동작하고 있는 서비스들의 인스턴스 정보를 추적하고 **서비스 레지스트리**에 저장한다.
	- 서비스 레지스트리: scale up/down 되었을 때 인스턴스의 정보가 해당 레지스트리에서 동적으로 추가/삭제 된다.
### 클라우드 네이티브 앱에 적용
- 중앙화된 서버가 전역에서 주소들을 유지하도록 한다.
- 마이크로서비스/클라이언트들이 시작하거나 준비되었을 때 중앙 서버에 등록하도록 한다.
- 마이크로서비스/클라이언트들이 heartbeat를 중앙 서버로 주기적으로 보내도록 한다.
	- 중앙 서버가 하트비트를 받지 못할 경우 해당 인스턴스가 불안정하다고 가정하고, 인스턴스에 대한 정보를 삭제한다.
## Client-side service discovery
- 애플리케이션들은 자신의 정보를 서비스 레지스트리에 자신을 등록해야하는 책임이 있다.
	- 삭제 될 때는 제거해야하는 책임이 있다.
	- 주기적으로 heartbeat를 보내 자신이 healthy함(정상적으로 연결을 받을 수 있는 상태)을 알린다.
- upstream 서비스가 downstream 서비스에게 요청을 보내는 과정
	- upstream 서비스는 downstream 서비스의 정보를 서비스 레지스트리에 질의(쿼리)한다.
	- 서비스 레지스트리는 현재 등록된 서비스의 인스턴스 정보들을 반환한다.
	- upstream 서비스는 로드밸런싱 전략에 따라 해당 서비스에 요청을 보낸다.
		- 실제 서비스를 호출하는 책임이 클라이언트에게 있으므로 이 전략을 **client-side service discovery**라고 부른다.
![[Pasted image 20240725142437.png]]
- 클라이언트 측 서비스 디스커버리(검색)의 장점
	- 로드밸런싱 전략을 선택할 수 있다.
		- 라운드 로빈
		- 가중치 라운드 로빈
		- 최소 연결
	- 하지만 개발자에게 이러한 전략 선택의 선택 혹은 구현의 책임이 따르기 때문에 단점으로 간주된다.
- 이러한 단점을 극복할 수 있는 서버 사이드 디스커버리 솔루션이 있다.
	- 쿠버네티스 환경 안에서 마이크로서비스를 배포할 때마다 구현해야 한다.
		- 쿠버네티스 안에 구현해야 하기 때문에 쿠버네티스 전담 팀이 필요하다.
		- 비용이 많이 든다.
- 서버 사이드 디스커버리의 비용을 감당할 수 없다면 클라이언트 사이드 디스커버리를 사용해야 한다.
	- 서비스 등록/검색을 지원하는 중앙화된 서버를 개발해야 한다.
	- 이 중앙화 된 서버를 **서비스 디스커버리 레이어**라고 부른다.
![[Pasted image 20240725144217.png]]
- 서비스 디스커버리 레이어가 클라이언트와 각 마이크로서비스를 연결하는 과정
	- 이 레이어에서는 예상되는 부하에 따라 서비스 디스커버리 레이어의 노드를 원하는 만큼 배포할 수 있다.
	- 마이크로서비스가 시작하기 전에 서비스 레지스트리가 정상적으로 실행 되었는지를 먼저 확인해야 한다.
	- [[해결해야 함]]: 서비스 디스커버리 레이어는 장애가 생기지 않는가? 클라이언트가 어떤 정보를 갖고 서비스 디스커버리 노드를 접근하는지 매커니즘이 궁금하다.
	- 각 서비스가 세부 정보를 등록할 때 [[gossip protocol]]에 따라 모든 서비스가 해당 세부 정보를 공유받는다.
![[Pasted image 20240725144607.png]]
- 마이크로서비스 간의 소통이 이루어지는 과정
	- 클라이언트 사이드에서 IP정보를 캐싱하고 있기 때문에 서비스 디스커버리 레이어에 대한 부담이 줄어든다.
		- 서비스 디스커버리 레이어로부터 주기적으로 인스턴스 정보들을 받아와 최신화 한다.
		- 클라이언트 사이드에서 캐싱된 정보로 다른 서비스와 통신하려는 경우 서비스 디스커버리에서 이를 무시하고 최신 정보를 받아오도록 한다.
---
### 생각(파생된 질문/생각)

### 출처
- [유데미 - Java, Spring Boot, Spring Cloud, Docker, Kubernetes, Helm, 마이크로서비스 보안](https://www.udemy.com/course/master-microservices-with-springboot-docker-kubernetes-korean/)

### 연결 문서 (연결 이유)
