---
ë‚ ì§œ: 2024-07-19
ë„˜ë²„: 
íƒœê·¸: í”„ë¡œê·¸ë˜ë°
ì €ì: Eazy Bytes
ì¶œì²˜: https://www.udemy.com/course/master-microservices-with-springboot-docker-kubernetes-korean/
aliases:
---
### ë‚ ì§œ:  2024-07-19 16:15

### íƒœê·¸: #í”„ë¡œê·¸ë˜ë° #ìë°” #ìŠ¤í”„ë§

>[!ë©”ëª¨]
>

### ì›ë¬¸
---
# actuatorë¥¼ ì´ìš©í•œ ì„¤ì • ë™ì  ë³€ê²½
- run timeì— ì‹œìŠ¤í…œì˜ ì„¤ì •ì„ ë™ì ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ë„ì›€ì„ ì£¼ëŠ” í”„ë ˆì„ì›Œí¬ì´ë‹¤.
### recordë¡œ ì„ ì–¸í•œ `ConfigurationDto` classë¡œ ë³€ê²½
- ê¸°ì¡´ì— `account`ì˜ contact ì •ë³´ë¥¼ DTO ë ˆì½”ë“œ í´ë˜ìŠ¤ë¡œ ìƒì„±í–ˆë‹¤.
- recordëŠ” finalë¡œ ì„ ì–¸ë˜ì–´ ë³€ê²½í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, classë¡œ ë³€ê²½í•´ì¤€ë‹¤.
```java
@ConfigurationProperties(prefix = "cards")  
@Getter  
@Setter  
public class AccountContactInfoDto {  
    private String message;  
    private Map<String, String> contactDetails;  
    private List<String> onCallSupport;  
}
```
### actucator ì„¤ì •
- ì‚¬ìš©í•  acutatorì˜ endpointë¥¼ '`*`'ë¡œ ì„¤ì •í•œë‹¤.
```yaml
management:  
  endpoints:  
    web:  
      exposure:  
        include: "*"
```
### ë™ì‘ í™•ì¸
- ê¹ƒí—ˆë¸Œ config ì €ì¥ì†Œì˜ ë‚´ìš©ì„ ë³€ê²½í•œë‹¤.
- í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ /actuator/refresh ë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒˆë¡œê³ ì¹¨ í•œë‹¤.
- ì‘ë‹µì„ ë°›ì€ ë’¤ ë³€ê²½ì ì„ í™•ì¸í•˜ë©´ ì ìš©ì´ ë˜ì–´ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
## Busë¥¼ ì´ìš©í•œ ëŸ°íƒ€ì„ ì„¤ì • ë³€ê²½
- ê° ì„œë¹„ìŠ¤ì˜ refresh APIë¥¼ í•˜ë‚˜ì”© í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ë²ˆê±°ë¡œìš¸ ìˆ˜ ìˆë‹¤.
- Spring Cloud BusëŠ” ë¶„ì‚° ì‹œìŠ¤í…œì˜ ë…¸ë“œë¥¼ message brokerì™€ ì—°ê²°í•´ì¤€ë‹¤.
	- message broker: RabbitMQ, Kafka
- ìƒíƒœì˜ ë³€ê²½ì´ë‚˜ ë‹¤ë¥¸ ê´€ë¦¬ ì§€ì¹¨ì„ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.
- SCBë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ RabbitMQê°€ ì¤€ë¹„ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.
### RabbitMQ ì„¤ì •
[ê³µì‹ í™ˆí˜ì´ì§€](https://www.rabbitmq.com/docs/download)
- ì˜ì¡´ì„± ì¶”ê°€
	- cloud bus
		- RabbitMQë„ í¬í•¨ë˜ì–´ìˆë‹¤.
		- ì´ë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ actuatorê°€ ì œê³µí•˜ëŠ” URIë¥¼ í†µí•´ ì„œë¹„ìŠ¤ë¥¼ ì¼ê´„ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

> [!warning]
 >  implementation 'org.springframework.cloud:spring-cloud-bus'  
>  implementation 'org.springframework.cloud:spring-cloud-starter-bus-amqp'
 >  
 >  ë‘ ì˜ì¡´ì„±ì˜ ì°¨ì´ì ì„ ëª¨ë¥´ê² ì§€ë§Œ, í›„ìë¥¼ ì„ íƒí•´ì•¼ í•œë‹¤.
 >  ì „ìë¥¼ ì‚¬ìš©í•  ê²½ìš° **bus bridgeë¹ˆ ì£¼ì…ì„ ì‹¤íŒ¨**í•˜ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

- ì„œë¹„ìŠ¤ ì„¤ì •
```yaml
spring:
  rabbitmq:
    host: "localhost"
    port: 5672
    username: "guest"
    password: "guest"
```
- config ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  ê¹ƒí—ˆë¸Œ config repoì˜ ë‚´ìš©ì„ ë³€ê²½í•˜ë©´ ìƒˆë¡œê³ ì¹¨ì„ í•˜ê±°ë‚˜, íŠ¹ì • URIë¡œ ìƒˆë¡œê³ ì¹¨ì„ ì‹¤í–‰í•˜ì§€ ì•Šì•„ë„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ê²½ì‚¬í•­ì´ ë°˜ì˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
### ë³€ê²½ëœ ì„¤ì •ì„ ê° ì„œë¹„ìŠ¤ì— ë°˜ì˜í•˜ê¸° ìœ„í•œ actuatorë¥¼ ì´ìš©í•œ bus ìƒˆë¡œê³ ì¹¨
- POST `/actuator/busrefresh`ë¥¼ ì „ì†¡í•˜ë©´ rabbitmqì— ë“±ë¡ëœ ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤.
![[Excalidraw/Java MSA.md#^group=PnYuG3DL-W2WcTe2kUXtb]]
## github webhookì„ ì´ìš©í•œ busrefresh ìë™í™”
### monitor
- [ê³µì‹ í™ˆí˜ì´ì§€ ë ˆí¼ëŸ°ìŠ¤](https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#_push_notifications_and_spring_cloud_bus)
- **ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤.**
	- `spring-cloud-config-monitor`
- ë³€ê²½ ì‚¬í•­ì„ ëª¨ë“  ì„œë¹„ìŠ¤ì— ì ìš©ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ APIë¥¼ ì—´ì–´ì£¼ëŠ” í”„ë ˆì„ì›Œí¬
### hookdeck
- [hookdeck ê³µì‹ í™ˆí˜ì´ì§€](https://hookdeck.com/)
- webhookì— `localhost`ë¡œ ì´ì–´ì§€ëŠ” endpointë¥¼ ì—´ì–´ì£¼ëŠ” ì„œë¹„ìŠ¤
#### ì„¤ì¹˜
```sh
$> brew install hookdeck/hookdeck/hookdeck
```
#### ë¡œê·¸ì¸
```sh
$> hookdeck login
```
#### API ì—°ê²°
```sh
$> hookdeck listen 8071 Source
? What path should the events be forwarded to (ie: /webh
? What's your connection label (ie: My API)? localhost

Dashboard
ğŸ‘‰ Inspect and replay events: https://dashboard.hookdeck.com?team_id=tm_GJJbQCiMyD63

source Source
ğŸ”Œ Event URL: https://hkdk.events/0dilzcgzv8v02u

Connections
localhost forwarding to /monitor

> Ready! (^C to quit)
```
#### webhook ë“±ë¡
![[Pasted image 20240720184156.png]]
- pushë¥¼ ê°ì§€í•˜ì—¬ ëª¨ë“  ì„œë¹„ìŠ¤ì— ì ìš©ì´ ëœë‹¤.
![[Pasted image 20240720185933.png]]
- terminal output
```log
2024-07-20 18:55:33 [200] POST http://localhost:8071/monitor | https://dashboard.hookdeck.com/cli/events/evt_Uy4Kg6HwHoUyKht87Z
```


---
### ìƒê°(íŒŒìƒëœ ì§ˆë¬¸/ìƒê°)

### ì¶œì²˜
- [ìœ ë°ë¯¸ - Java, Spring Boot, Spring Cloud, Docker, Kubernetes, Helm, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë³´ì•ˆ](https://www.udemy.com/course/master-microservices-with-springboot-docker-kubernetes-korean/)

### ì—°ê²° ë¬¸ì„œ (ì—°ê²° ì´ìœ )
