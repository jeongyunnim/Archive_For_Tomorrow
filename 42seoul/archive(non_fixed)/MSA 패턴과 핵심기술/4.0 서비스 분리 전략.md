---
날짜: '"2024-02-10"'
넘버: 
태그: 프로그래밍
출처: "마이크로서비스 아키텍처: MSA"
강사: 코드프레소
aliases:
---
### 날짜  2024-02-10 17:27

### 태그: #프로그래밍 

>[!메모]
>

### 원문
---
# 서비스 분리 전략
- 서비스 분리 원칙 및 고려 사항
- [[도메인 주도 설계]]
- 서비스 분리 패턴
- 데이터 베이스 분리 패턴
- 서비스 분리 프로세스
### 3가지 key
- 단계적 마이그레이션을 시도하라.
- 처음에는 크게 분리하고 추후에 작게 분리.
- 서비스 분리의 공식은 없다.
### MSA 전환을 고민해야 할 것.
- 모놀리틱 분리 방법에 대한 기준
- 서비스 분리의 First Step
- 분리 대상 서비스의 선택
	- 무엇부터 분리할지
- 적절한 서비스의 크기 결정
- 기존 코드 재사용 vs 서비스 재개발
### 작고 분리가 쉬운 서비스로 워밍업
- 다양한 사전 준비사항
	- 클라우드, 배포 pipeline, 컨테이너, 모니터링 등
- 역량 내재화
- 한 두개를 먼저 분리하며 인프라와 프로세스를 구축한다.
- 작은 pilot 서비스를 선택
	- 크게 중요하지 않은 작은 기능들
	- 선정 기준
		- 내부적인 의존성이 가장 적은 기능
		- 장애가 발생해도 전체 시스템에 영향이 적은 기능
		- 데이터의 크기, 테이블의 개수가 적은 기능
### 핵심 기능 분리
- 워밍업이 끝나면 개발/운용팀 모두 MSA로 전환
	- 회고를 진행한 후 핵심 기능 분리에 대응할 준비를 해야한다.
- 다른 기능들과의 결합도가 높다.
- 도메인의 경계가 명확하지 않을 가능성이 높다.
	- 장기간 유지보수
	- 요구사항의 변화
	- 개발자 변경
- 분리할 핵심 기능의 도메인을 명확하게 해야한다.
	- 상품 전시, 결제, 회원, 추천 등 도메인을 발견하고 분리 대상을 선정해야 한다.
- 비즈니스 팀 구조를 기반으로 분리
- 도메인 주도 설계 적용
	- Event Storming을 수행하여 Sub Domain 및 Bounded Context를 발견하는 것.
	- 고객이 발생 시키는 이벤트를 시작점으로 한 Path를 발견하는 것.
		- 회원 가입 - 데이터 저장 - 이메일 발송 - 포인트 적립
	- 엔지니어와 도메인 전문가(사업팀, 기획팀)도 참여하여 비즈니스 핵심 도메인을 정의해야 함.
- 의존성 분석 과정이 필요
	- 네트워크를 통한 인터페이스로 전환하게 된다.
	- 정적분석 프로세스
		- Method call, Inheritance, Table Join 등
		- Structure 101 등 도구를 사용할 수 있음.
### 데이터의 분리 
- 서비스들의 독립적 배포가 중요
	- 서비스 간의 결합도를 최소한으로 유지해야 함.
	- 데이터베이스의 분리가 필수적
- 독립된 저장소 및 데이터 migration 전략 수립이 동반되어야 함.
### 분리 대상 선정
- 조직의 목표를 명확하게 수립
	- 가장 문제가 되는 것은 무엇인가?
	- 비즈니스 요구사항 변경이 빈번할 기능이 무엇인가?
	- 잦은 코드 수정으로 빌드/배포를 야기하는 기능이 무엇인가?
	- 유연한 수평 확장이 필요한 기능은 무엇인가?
- 변경의 관점에서 분리 대상 선정
- 코드 커밋 히스토리 파악하여 선정
- 프로젝트 로드맵을 기반으로 선정
### 코드의 재사용 vs 재개발
- 코드 재사용이 효율적으로 보인다.
	- 비효율을 초래할 가능성이 높다.
	- 오랜 기간 유지보수된 코드일 것.
		- 기술 부채가 많이 쌓여 있을 수 있음
		- 기술 자체가 오래되었을 수도 있음
		- 요구사항이 많이 변경되어있을 수 있음
		- 비즈니스 도메인이 명확하게 반영되어 있지 않을 수 있음
	- 오래된 기술의 DB, Framework, Library와 관련된 Boilerplate Code가 많을 수 있다.
- 재개발의 장점
	- 요구사항을 다시 파악하여 해당 기능에 대한 비즈니스 도메인을 명확화
	- 비즈니스에 대한 더 높은 이해로 아키텍처 재설계 가능
	- 기존의 기술 부채 해결
	- 새로운 기술 스택을 도입하여 Polyglot 아키텍처를 만족 가능
### 진화적 서비스 분리
- 서비스의 크기
	- 얼마나 작게 분리할 것인가?
	- 정답은 없다.
- Go Macro, then Micro
	- 우선 크게 분리하고 필요한 경우 재설계를 통해 더 작게 분리
- 서비스의 크기가 너무 작다면
	- 각 서비스는 응집도 높은 비즈니스 로직 없이 테이블에 대한 CRUD수행할 수 있음
	- 서비스의 개수가 너무 늘어날 수 있음
	- 운영에 대한 복잡도 상승
- 크기에 대한 휴리스틱
	- Two Pizza Team
	- 한 사람의 머리로 전체 관리 가능한 수준
	- 2주 안에 완전 재작성 될 수 있는 수준
	- 독립적으로 배포 가능한 수준
### 반복/점진적 분리
- 작고 명확한 계획으로 여러 단계를 만드는 것이 유리하다.
- 한 번에 하나씩 단계적으로 분리
> The only thing a Big Bang re-architecture guarantees is a Big Bang!
> - Martin Fowler
- 클라이언트로부터의 Request를 신규 서비스로 전환
	- Proxy가 필요하다.
	- 최종적으로는 Proxy도 없어지는 것이 목표
- 기존 코드는 잠시 유지 후 반드시 제거하는 것이 목표.
### MSA와 함께 신기술의 도입
- 혁신과 실험을 가능하게 한다.
- MSA를 막 도입하는 시점에서의 혁신은 복잡도를 크게 증가할 수 있다.
- 초기에는 기본적 인프라스트럭처, 방법론, 조직 세팅등 리소스가 많이 들 것이다.
	- 안정적으로 도입이 된 후에 시도하라.
### 서비스 분리와 조직
- 서비스를 분리하여 서비스 전담 팀을 구축하라.
	- 기존 기능 유지보수를 하면서 MSA 분리까지 하는 것은 어렵다.
	- 분리가 성공될 때까지.
---
### 생각(파생된 질문/생각)

### 출처
- https://www.udemy.com/course/codepressomsa/

### 연결 문서 (연결 이유)
